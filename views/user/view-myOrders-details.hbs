<div class="container">
    <div class="row">
        <div class="col-md-11">
            <div class=" mt-3 main border border-1">
                <div class="d-flex border border-2 p-3 justify-content-between">
                    <div>
                        <h6 class="d-flex">
                            <i id="orderPageRedirect" style="font-size: 1.3rem; color: black;"
                                class="fa-solid fa-arrow-left"></i>
                            <div class="px-2">
                                ORDER RATING
                            </div>
                        </h6>
                    </div>
                    <div>
                        <h6 class="" style="color: rgb(19, 107, 249);">
                            Leave a Rating
                            <i class="fa-solid fa-plus"></i>
                        </h6>
                    </div>
                </div>
                {{!-- --}}
                <div class="border border-1 mt-1 py-4">

                    <div class="rounded-1 mb-2 mt-3 p-3 ms-3 me-3" style="background-color: rgb(225, 225, 225);">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="px-0 px-md-3">
                                <h5>{{order.orderNumber}}</h5>
                                <p class="order-details"><span> {{order.products.length}} </span>
                                    <span>{{productCheck order.products.length}}.</span>
                                    <span>Order Placed in 4 August, 2024 at 4:40pm</span>
                                </p>
                            </div>
                            <div class="ms-auto px-0">
                                <h4 class="order-details-total-amount">
                                    ₹ <span>
                                        {{order.totalSalePrice}}
                                    </span>.00
                                </h4>
                            </div>
                        </div>
                    </div>
                    {{!-- Order Expect Date --}}
                    <div class="py-1">
                        <p class="px-3">
                            Order expected arrival <span>28 May, 2024</span>
                        </p>
                    </div>

                    {{!-- Order progress --}}
                    <div class="px-md-5 px-3">
                        <div class="px-md-5 px-0">
                            <div class="progress" role="progressbar" aria-label="info striped example"
                                aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
                                <div class="progress-bar progress-bar-striped bg-info"
                                    style="width: {{orderProgress order.status}}%"></div>
                                {{!-- <div class="progress-bar progress-bar-striped bg-info" style="width: 100%"></div>
                                --}}

                            </div>
                            <div class="d-flex justify-content-between mt-2">
                                <div class="mt-2">
                                    <i style="font-size: 1.5rem; color: rgb(46, 201, 11);"
                                        class="fa-regular fa-clipboard ms-2 "></i>
                                    <div class="progress-names">
                                        Order Placed
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <i style="font-size: 1.5rem; color: rgb(15, 80, 244);"
                                        class="fa-solid fa-box-archive ms-3"></i>
                                    <div class="progress-names">
                                        Packaging
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <i style="font-size: 1.5rem; color: rgba(254, 24, 24, 0.864);"
                                        class="fa-solid fa-truck-fast ms-3"></i>
                                    <div class="progress-names">
                                        Out for Delivery
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <i style="font-size: 1.5rem; color: rgb(46, 201, 11);"
                                        class="fa-regular fa-handshake ms-2 ms-md-3"></i>
                                    <div class="progress-names">
                                        Delivered
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                {{!-- --}}
                <div class="border border-1">
                    <h5 class="p-3 px-3">Order Activity</h5>
                    {{#each order.orderActivity}}
                    <div class="d-flex">

                        {{#if (isorderStatusPending this.orderStatus)}}
                        <div style="background-color: rgb(112, 246, 112);" class=" ms-3 mb-3 mb-md-2 rounded-1">
                            <i style="font-size: 2rem; color: rgb(9, 145, 4);"
                                class="fa-solid fa-clipboard-check mt-4 mt-md-3 px-4"></i>
                        </div>
                        {{else}}
                        {{#if (isorderStatusProcessing this.orderStatus)}}
                        <div style="background-color: rgb(87, 184, 248);" class=" ms-3 mb-3 mb-md-2 rounded-1">
                            <i style="font-size: 2rem; color: rgb(211, 234, 250);"
                                class="fa-solid fa-clipboard-check mt-4 mt-md-3 px-4"></i>
                        </div>
                        {{else}}
                        {{#if (isorderStatusShipped this.orderStatus)}}
                        <div style="background-color: rgb(112, 246, 112);" class=" ms-3 mb-3 mb-md-2 rounded-1">
                            <i style="font-size: 1.4rem; color: rgb(9, 145, 4);" class="fa-solid fa-ship mt-4 px-4"></i>
                        </div>
                        {{else}}
                        {{#if (isorderStatusOutForDelivery this.orderStatus)}}
                        <div style="background-color: rgb(87, 184, 248);" class="ms-3 mb-3 mb-md-2 rounded-1">
                            <i style="font-size: 1.3rem; color: rgb(211, 234, 250);"
                                class="fa-solid fa-truck-ramp-box mt-4 px-4"></i>
                        </div>
                        {{else}}
                        {{#if (isorderStatusDelivery this.orderStatus)}}
                        <div style="background-color: rgb(112, 246, 112);" class="ms-3 mb-3 mb-md-2 rounded-1">
                            <i style="font-size: 1.8rem;color: rgb(9, 145, 4); "
                                class="fa-solid fa-check-double mt-4 mt-md-3 px-4"></i>
                        </div>
                        {{else}}
                        <div class="bg-danger ms-3 mb-3 mb-md-2 rounded-1">
                            <i style="font-size: 1.3rem;" class="fa-solid fa-truck-ramp-box mt-4 px-4"></i>
                        </div>
                        {{/if}}
                        {{/if}}
                        {{/if}}
                        {{/if}}
                        {{/if}}
                        <div class="mt-2 px-2">
                            <h6> {{this.message}} </h6>
                            <p class="text-secondary">19 Jan, 2021 at 2:61 PM</p>
                        </div>

                    </div>
                    {{/each}}
                </div>

                <div class="border border-1">
                    <h5 class="mt-4 px-3">Product ( <span> {{productNumbercheck order.products.length}} </span> )</h5>
                    <div class="px-4 py-2 table-responsive">
                        <table class="table table-borderless">
                            <thead class="table-secondary border border-light">
                                <tr>
                                    <th class="text-dark font-sm" scope="col">PRODUCTS</th>
                                    <th class="text-dark font-sm" scope="col">PRICE</th>
                                    <th class="text-dark font-sm" scope="col">QUANTITY</th>
                                    <th class="text-dark font-sm" scope="col">SUB-TOTAL</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#each order.products}}
                                <tr>
                                    <td>
                                        <div class="d-flex">
                                            <div>
                                                <img style="height: 6rem; width: 8rem;" src="/uploads/{{this.image}}"
                                                    class="card-img-top mx-auto product-image pt-1" alt="..." />
                                            </div>
                                            <div class="pt-0 pt-md-5" style="color: rgb(4, 120, 244)">
                                                {{this.productName}}
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="mt-5">
                                            ₹<span> {{this.salePrice}} </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="mt-5 px-3">
                                            x<span> {{this.quantity}} </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="mt-5 px-3">
                                            ₹<span> {{productTotal this.quantity this.salePrice}} </span>
                                        </div>
                                    </td>
                                </tr>
                                {{/each}}
                            </tbody>
                        </table>
                    </div>

                </div>

                {{!-- Address part --}}
                <div class="border border-1">
                    <div class="d-md-flex d-block justify-content-evenly">
                        <div class="card py-2" style="width: 18rem; border: none;">
                            {{#if billingAddress}}
                            <div class="card-body">
                                <h5 class="card-title">Billing Address</h5>
                                <h6 class="card-subtitle mb-2 text-body-secondary mt-2"> {{order.address.firstName}}
                                    {{order.address.lastName}} </h6>
                                <p class="card-text">
                                    {{billingAddress.address}}
                                </p>
                                <p class="card-text">
                                    Phone: <span>{{billingAddress.mobile}}</span>
                                </p>
                                <p class="card-text">
                                    Email: <span> {{user.email}} </span>
                                </p>
                            </div>

                            {{else}}

                            <div class="card-body">
                                <h5 class="card-title">Billing Address</h5>
                                <h6 class="card-subtitle mb-2 text-body-secondary mt-2"> {{order.address.firstName}}
                                    {{order.address.lastName}} </h6>
                                <p class="card-text">
                                    {{order.address.address}}
                                </p>
                                <p class="card-text">
                                    Phone: <span>{{order.address.mobileNumber}}</span>
                                </p>
                                <p class="card-text">
                                    Email: <span> {{user.email}} </span>
                                </p>
                            </div>


                            {{/if}}
                        </div>
                        <div class="border"></div>
                        <div class="card py-2" style="width: 18rem; border: none;">
                            <div class="card-body">
                                <h5 class="card-title">Shipping Address</h5>
                                <h6 class="card-subtitle mb-2 text-body-secondary mt-2"> {{order.address.firstName}}
                                    {{order.address.lastName}} </h6>
                                {{#if (isCompany order.address.companyName)}}
                                <p class="card-text">
                                    {{order.address.companyName}}
                                </p>
                                {{/if}}
                                <p class="card-text">
                                    {{order.address.address}}
                                </p>
                                <p class="card-text">
                                    Phone: <span> {{order.address.mobileNumber}} </span>
                                </p>
                                <p class="card-text">
                                    Email: <span> {{user.email}} </span>
                                </p>
                            </div>
                        </div>
                        <div class="border"></div>
                        <div class="card py-2" style="width: 18rem; border: none;">
                            <div class="card-body">
                                <h5 class="card-title">Order Notes</h5>
                                <p class="card-text">
                                    Nill
                                </p>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </div>



        {{#if (isCancelled order.status)}}
        <div class="col-md-1">
            <div class="ms-auto me-1 me-md-4 mt-4 d-md-block d-flex justify-content-center">
                <div class="invoice">
                    <div class="btn text-light" style="background-color: #F46F36; border: 1px solid white;">Invoice
                    </div>
                </div>
            </div>
        </div>
        {{else}}
        {{#if (isDelivered order.status)}}
        <div class="col-md-1">
            <div class="ms-auto me-1 me-md-4 mt-4 d-md-block d-flex justify-content-center">
                <div class="invoice">
                    <div class="btn text-light" style="background-color: #F46F36; border: 1px solid white;">Invoice
                    </div>
                    <div class="return">
                        <div class="btn text-light"
                            style="background-color: rgb(35, 196, 35); border: 1px solid white;">Return</div>
                    </div>
                </div>
            </div>
        </div>
        {{/if}}

        {{#if (isReturned order.status)}}
        <div class="col-md-1">
            <div class="ms-auto me-1 me-md-4 mt-4 d-md-block d-flex justify-content-center">
                <div class="return">
                    <div class="btn text-light" style="background-color: rgb(35, 196, 35); border: 1px solid white;">
                        Return</div>
                </div>
            </div>
        </div>
        {{/if}}

        <div class="col-md-1">
            <div class="ms-auto me-1 me-md-4 mt-4 d-md-block d-flex justify-content-center">
                <div class="cancel" onclick="myOrderUpdate('{{order._id}}', 'Cancelled', 'cancel-order')">
                    <div class="btn text-light" style="background-color: black; border: 1px solid white;">Cancel</div>
                </div>
            </div>
        </div>
        {{/if}}


    </div>
</div>


<script>

    /*
    // Order Detail Page back Button
    const backBtn = document.querySelector('#orderPageRedirect')
    backBtn.addEventListener('click', () => {
        window.location.href = "/dashboard/orders"
    })
    */

    // Cancel My order
    function myOrderUpdate(orderID, orderUpdate, urlEndpoint) {
        Swal.fire({
            title: 'Are you sure?',
            text: `Do you wanna cancel the order?`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, delete it!',
            cancelButtonText: 'No, cancel!',
        }).then(result => {
            if (result.isConfirmed) {
                $.ajax({
                    url: `/dashboard/orders/${urlEndpoint}`,
                    method: 'PUT',
                    data: {
                        orderID,
                        orderUpdate
                    },
                    success: response => {
                        if (response.status) {
                            Swal.fire(response.message)
                        }
                    }
                })
            }
        })
    }
</script>